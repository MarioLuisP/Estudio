<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>foto perfil</title>

    <!-- FontAwesome CDN for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.0/css/all.min.css"
    />

    <style>
      /* =========================== */
      /* Reset general de estilos    */
      /* =========================== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      /* =========================== */
      /* Estilos generales del body  */
      /* =========================== */
      body {
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        height: 100vh;
      }

      /* =========================== */
      /* Header y Footer             */
      /* =========================== */
      header,
      footer {
        flex: 0 0 10%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 20px;
        background-color: #816952;
        font-size: 2.5rem; /* Ajusta el valor según sea necesario */
        color: white;
      }

      /* Logo */
      .logo img {
        margin-top: 8px;
        margin-bottom: 8px;
        width: 150px;
        height: auto;
        border-radius: 12px;
      }

      /* Menú desplegable */
      .menu {
        position: relative;
      }

      .menu button {
        background: none;
        border: none;
        color: white;
        font-size: 2.5rem;
        cursor: pointer;
      }

      .menu ul {
        display: none;
        position: absolute;
        right: 0;
        top: 100%;
        background-color: #665337;
        border-radius: 12px;
        width: 180px;
        list-style: none;
        padding: 0;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      }

      .menu ul li {
        border-bottom: 1px solid #eceacb;
        padding: 12px 15px;
      }

      .menu ul li:last-child {
        border-bottom: none;
      }

      .menu ul li a {
        text-decoration: none;
        color: #ffffff;
        font-size: 18px;
        display: flex;
        align-items: center;
        border-radius: 12px;
      }

      .menu ul li a:hover {
        border-radius: 4px;
        background-color: #bb8c47;
      }

      .menu ul li i {
        margin-right: 10px;
        color: #011216;
      }
      .menu ul li a i {
        color: white;
      }

      /* Mostrar menú desplegable */
      .menu:hover ul {
        display: block;
      }

      /* =========================== */
      /* Main: Layout de columnas    */
      /* =========================== */
      main {
        flex: 1;
        display: flex;
      }

      .column {
        flex: 0 0 20%;
        background-size: cover;
        background-position: center;
      }

      .column.left {
        background-image: url("imag1.jpg");
      }

      .column.middle {
        flex: 0 0 60%;
        background-color: #f4f4f4;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .column.right {
        background-image: url("imag3.jpg");
      }

      /* =========================== */
      /* Formulario                  */
      /* =========================== */
      .form-container {
        width: 100%;
        max-width: 400px;
        text-align: center;
        padding: 20px; /* Agregar padding alrededor del contenedor */
        border: 1px solid #ccc;
        border-radius: 10px;
        background-color: #f9f9f9;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .form-container label {
        display: block;
        margin: 10px 0 5px;
      }

      .form-container input {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #0f3d3d;
        border-radius: 5px;
      }

      .form-container button {
        width: 100%;
        padding: 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .form-container button:hover {
        background-color: #0056b3;
      }

      .form-container a {
        color: #007bff;
        text-decoration: none;
        display: block;
        margin: 8px 0;
      }

      .form-container a:hover {
        text-decoration: underline;
      }

      .google-auth button {
        margin: 20px 0;
        background-color: #d6868d;
      }

      /* =========================== */
      /* Footer: Redes Sociales      */
      /* =========================== */
      .social-icons {
        display: flex;
        gap: 20px;
      }

      .social-icons a {
        color: white;
        font-size: 1.5rem;
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <!-- =========================== -->
    <!-- Header con Logo y Menú      -->
    <!-- =========================== -->
    <header>
      <div class="logo">
        <img src="https://i.imgur.com/ZH6xioV.jpeg" alt="Logo" />
      </div>
      <div class="text">Shift</div>
      <div class="menu">
        <button>&#9776;</button>
        <ul>
          <li>
            <a href="html1.html"><i class="fa-solid fa-house"></i> HTML1</a>
          </li>
          <li>
            <a href="html2.html"><i class="fa-solid fa-user"></i> HTML2</a>
          </li>
          <li>
            <a href="html3.html"><i class="fa-solid fa-envelope"></i> HTML3</a>
          </li>
          <li>
            <a href="html4.html"
              ><i class="fa-solid fa-layer-group"></i> HTML4</a
            >
          </li>
          <li>
            <a href="html5.html"><i class="fa-solid fa-gear"></i> HTML5</a>
          </li>
        </ul>
      </div>
    </header>

    <!-- =========================== -->
    <!-- Main Content                -->
    <!-- =========================== -->
    <main>
      <div class="column left"></div>
      <div class="column middle">
        <div class="form-container">
          <h2>Foto de perfil</h2>
          <form id="userForm" enctype="multipart/form-data">
            <!-- Login Section -->
            <label for="email">Correo Electrónico</label>
            <input type="email" id="email" placeholder="Correo Electrónico" />

            <label for="password">Contraseña</label>
            <input type="password" id="password" placeholder="Contraseña" />

            <button type="button" onclick="validateLogin()">Mi perfil</button>

            <!-- Profile Section (Hidden initially) -->
            <div id="profile-section" style="display: none">
              <p id="user-name"></p>

              <input type="file" id="photo" accept="image/*">
              <button type="button" onclick="uploadPhoto(); return false;">Subir Foto</button>
              <div id="uploadStatus"></div>
              <div style="display: flex; justify-content: center; align-items: center;">
                <img id="previewImage" style="max-width: 40%; max-height: 300px; margin-top: 10px; display: none;">
              </div>
              
                          </div>
          </form>

          <div id="api-response"></div>
        </div>
      </div>
      <div class="column right"></div>  // Mostrar preview de la imagen seleccionada
        document.getElementById('photo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const previewImage = document.getElementById('previewImage');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    previewImage.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

    </main>
    <!-- =========================== -->
    <!-- Footer: Redes Sociales      -->
    <!-- =========================== -->
    <footer>
      <div class="social-icons">
        <a href="https://twitter.com" target="_blank"
          ><i class="fa-brands fa-x-twitter"></i
        ></a>
        <a href="https://linkedin.com" target="_blank"
          ><i class="fa-brands fa-linkedin"></i
        ></a>
        <a href="https://instagram.com" target="_blank"
          ><i class="fa-brands fa-instagram"></i
        ></a>
        <a href="https://facebook.com" target="_blank"
          ><i class="fa-brands fa-square-facebook"></i
        ></a>
      </div>
    </footer>

    <!-- =========================== -->
    <!-- Script de envío de datos al backend        -->
    <!-- =========================== -->
    <script>
      async function validateLogin() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();

  try {
    const response = await fetch("http://localhost:3000/api/login", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({ email, password }),
    });

    if (!response.ok) {
      const errorText = await response.text();
      document.getElementById("api-response").innerText =
        errorText || "Correo o contraseña incorrectos.";
      return;
    }

    const userData = await response.json();
    
    // Guardar el ID del usuario en localStorage
    localStorage.setItem('userId', userData.user.id);
    
    // Opcional: También podemos guardar otros datos del usuario
    localStorage.setItem('userName', userData.user.name);

    // Mostrar nombre y habilitar sección de perfil
    document.getElementById("user-name").innerText = `Hola, ${userData.user.name}`;
    document.getElementById("profile-section").style.display = "block";
    document.getElementById("photo").disabled = false;
    document.getElementById("api-response").innerText = ""; // Limpiar mensajes de error

    // Opcional: Agregar console.log para debug
    console.log("ID de usuario guardado:", userData.user.id);

  } catch (error) {
    console.error("Error al validar usuario:", error);
    document.getElementById("api-response").innerText =
      "Error en el servidor. Por favor, intenta más tarde.";
  }
}
  // Mostrar preview de la imagen seleccionada
  document.getElementById('photo').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const previewImage = document.getElementById('previewImage');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    previewImage.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });


        async function uploadPhoto() {
    const photoInput = document.getElementById("photo");
    const statusDiv = document.getElementById("uploadStatus");
    const botonSubir = document.querySelector('button');
    
    // Obtener userId del localStorage
    const userId = localStorage.getItem('userId');
    
    if (!userId) {
        mostrarEstado("Usuario no identificado. Por favor, inicie sesión nuevamente.", "error");
        return;
    }

    if (!photoInput.files[0]) {
        mostrarEstado("Por favor, selecciona una foto.", "error");
        return;
    }

    const formData = new FormData();
    formData.append("photo", photoInput.files[0]);
    formData.append("id", userId);

    try {
        mostrarEstado("Subiendo foto...", "");
        botonSubir.disabled = true; // Deshabilitar el botón durante la subida
        
        const response = await fetch(`http://localhost:3000/api/upload-photo?id=${userId}`, {
  method: "PUT",
  body: formData
        });

        const responseText = await response.text();

        if (response.ok) {
            mostrarEstado("Foto subida exitosamente", "success");
            
            // Usar una Promesa para asegurar el retraso
            await new Promise(resolve => {
                setTimeout(() => {
                    photoInput.value = ""; // Limpiar el input
                    document.getElementById('previewImage').style.display = 'none';
                    botonSubir.disabled = false; // Rehabilitar el botón
                    resolve();
                }, 2000);
            });
        } else {
            mostrarEstado(responseText || "Error al subir la foto", "error");
            botonSubir.disabled = false;
        }
    } catch (error) {
        console.error("Error al subir la foto:", error);
        mostrarEstado("Error en el servidor. Por favor, intenta más tarde.", "error");
        botonSubir.disabled = false;
    }
}

function mostrarEstado(mensaje, tipo) {
    const statusDiv = document.getElementById("uploadStatus");
    statusDiv.textContent = mensaje;
    statusDiv.className = tipo;
}

document.addEventListener('DOMContentLoaded', () => {
    console.log("ID de usuario en localStorage:", localStorage.getItem('userId'));
});
    </script>
  </body>
</html>
